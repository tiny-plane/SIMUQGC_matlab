load MY3.mat;
% 几何数据
geo.b = 7;
geo.MAC = 0.4;
geo.Sw = 2.8;

geo.Lp = 1;%螺旋桨到对称面的侧向距离

geo.Xcg = 0.045;
geo.Xcg_ref = 0.035;
geo.Ygear = 1.418;
geo.Xgear = 0.466;
geo.XMgear = 0.0752;
geo.Zgear = 0.4;
XMG_E = -geo.XMgear;
XFG_E = geo.Xgear - geo.XMgear;
ZMG_E = geo.Zgear;
ZFG_E = geo.Zgear;
dcm = angle2dcm(0,deg2rad(0),0,'XYZ');

GearData.PLF = dcm*[XFG_E,-geo.Ygear/2,ZFG_E]';
GearData.PRF = dcm*[XFG_E,geo.Ygear/2,ZFG_E]';
GearData.PLM = dcm*[XMG_E,-geo.Ygear/2,ZMG_E]';
GearData.PRM = dcm*[XMG_E,geo.Ygear/2,ZMG_E]';
GearData.R = 0.035; % 机轮半径
GearData.Sp = 5000;
%GearData.Sp = 4905.2; % 机轮弹性系数，该系数与稳态时的压缩量有关
GearData.Damp = 2000;
GearData.CompMax = 0.005;% 最大压缩量
GearData.muRoll = 0.03;% 滚动摩擦系数
% GearData.muA = 0.33; % 侧向力的A系数
GearData.muA = 0.01; % 侧向力的A系数
GearData.muB = 0.000; % 侧向力的B系数

MCdata.mass = 15.5;
Ixx = 31;
Iyy = 0.9;
Izz = 32;
Ixz = 0.1;
MCdata.I = [Ixx,0,-Ixz;0,Iyy,0;-Ixz,0,Izz];

Motor.dt = 0:0.1:1;
Motor.rpm = [0,1165,1840,2750,3439,4144,4820,5284,5699,6258,6288]';
Prop.J = 0:0.01:0.79;
Prop.CT = ...
    [0.091615
    0.091359
    0.09109
    0.090807
    0.090508
    0.090194
    0.089863
    0.089515
    0.089149
    0.088764
    0.088359
    0.087934
    0.087487
    0.087018
    0.086525
    0.086008
    0.085467
    0.084899
    0.084304
    0.083681
    0.08303
    0.082348
    0.081636
    0.080892
    0.080116
    0.079306
    0.078463
    0.077584
    0.076669
    0.075718
    0.074731
    0.073706
    0.072643
    0.071542
    0.070403
    0.069225
    0.068008
    0.066754
    0.065461
    0.06413
    0.062763
    0.061359
    0.059919
    0.058446
    0.056938
    0.055399
    0.05383
    0.052232
    0.050607
    0.048957
    0.047285
    0.045592
    0.043881
    0.042154
    0.040415
    0.038665
    0.036908
    0.035146
    0.033383
    0.03162
    0.029861
    0.028108
    0.026365
    0.024634
    0.022917
    0.021218
    0.019539
    0.017881
    0.016247
    0.01464
    0.013061
    0.011511
    0.009993
    0.008508
    0.007057
    0.005641
    0.004261
    0.002918
    0.001613
    0.000345];
Prop.CP = ...
    [0.036117
    0.036115
    0.036114
    0.036112
    0.03611
    0.036107
    0.036104
    0.036101
    0.036098
    0.036094
    0.036089
    0.036084
    0.036079
    0.036072
    0.036065
    0.036057
    0.036048
    0.036037
    0.036026
    0.036012
    0.035997
    0.035981
    0.035962
    0.03594
    0.035916
    0.035889
    0.035858
    0.035824
    0.035785
    0.035741
    0.035692
    0.035636
    0.035574
    0.035503
    0.035424
    0.035336
    0.035236
    0.035124
    0.034999
    0.034858
    0.034701
    0.034526
    0.03433
    0.034111
    0.033868
    0.033598
    0.033298
    0.032966
    0.032599
    0.032196
    0.031752
    0.031266
    0.030736
    0.03016
    0.029536
    0.028863
    0.028141
    0.02737
    0.026551
    0.025686
    0.024778
    0.023831
    0.022849
    0.021839
    0.020807
    0.019759
    0.018704
    0.017649
    0.016601
    0.015569
    0.014559
    0.013578
    0.012631
    0.011724
    0.010859
    0.01004
    0.00927
    0.008548
    0.007876
    0.007252];
Prop.D = 16*2.54*0.01; %桨叶直径
Prop.Y = 1.3;
LProp.P = [0,-Prop.Y,0];
RProp.P = [0,Prop.Y,0];
LProp.C = 1;
RProp.C = -1;
%% 仿真初始状态
HGround = 500;%海拔500m
H = HGround + geo.Zgear + GearData.R - MCdata.mass*9.8/4/GearData.Sp;
ini.Xe = [0,0,-H-0.2];
Ve = [0,0,0];
ini.Vb = dcm*Ve';
ini.euler = deg2rad([0,0,0]);%停机角-2度
ini.pqr = deg2rad([0,0,0]);
ini.mass = MCdata.mass;
ini.inertia = MCdata.I;

%% 控制器参数
% 地面滑跑
Ky=1.4207;
Kvy=4.3115;
Kr=3.1612;
Kchi=0.9968;
Kay=5.0275;

Kk = 1;%参数拉偏比例
%%  
phi_max=20;
phi_min=-20;
theta_max=20;
theta_min=-20;
psi_max=30;
psi_min=-30;
Xmax=0.01;
Xmin=0;
Ymax=0.01;
Ymin=0;
Zmax=0.01;
Zmin=0;